# `backend/` - The Rust Canister

Smart contract backend deployed on the Internet Computer, written in Rust.

## Core Components

- **`lib.rs`**: All canister logic
- **`Cargo.toml`**: Dependencies (ic-cdk, stable structures)
- **`backend.did`**: Auto-generated Candid interface (gitignored)

## Stable Storage Architecture

Uses `ic-stable-structures` for data that persists across canister upgrades:

```rust
thread_local! {
    static MEMORY_MANAGER: RefCell<MemoryManager<DefaultMemoryImpl>>
    static ID_COUNTER: RefCell<StableCell<u64, Memory>>
    static ITEMS: RefCell<StableBTreeMap<ItemId, Item, Memory>>
}
```

**MemoryIds:**
- `0` - ID counter
- `1` - Items BTreeMap
- Add more as needed (2, 3, 4...)

## Query vs Update

- **`#[ic_cdk::query]`** - Read-only, fast (no consensus)
- **`#[ic_cdk::update]`** - Can modify state (slower, consensus required)

## Authentication

`ic_cdk::caller()` returns the `Principal` of the caller. Use for ownership/permissions.

## Adding New Functions

1. Define struct with `#[derive(CandidType, Serialize, Deserialize)]`
2. Implement `Storable` if storing in stable structures
3. Add `#[ic_cdk::query]` or `#[ic_cdk::update]` function
4. Export with `ic_cdk::export_candid!()`

## Best Practices

1. **Use Result<T, String>** for error handling
2. **Validate caller** for privileged operations
3. **Store timestamps** (use `ic_cdk::api::time()`)
4. **Keep state in stable structures** for upgrade safety

## Rebuild

```bash
cargo build --target wasm32-unknown-unknown --release -p backend
candid-extractor target/wasm32-unknown-unknown/release/backend.wasm > backend/backend.did
```

Or simply: `dfx deploy backend`
